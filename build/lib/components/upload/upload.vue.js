"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),C=require("../button/button.vue.js"),p=require("../icon/icon.vue.js"),S=require("../utils/useReset.js"),$={class:"gov-upload__header"},x={class:"gov-upload__label"},z=["multiple","disabled"],q={key:0,class:"gov-upload__tip-append"},T={key:0,class:"gov-upload__tip"},D={class:"gov-upload__box"},j={class:"gov-upload__status"},w={class:"gov-upload__info"},R={class:"gov-upload__view"},F=["src"],A={class:"gov-upload__txt"},M=["onClick"],O={key:0,class:"gov-upload__progress"},P=Object.assign({name:"GovUpload"},{__name:"upload",props:{modelValue:{type:Array,default:()=>[]},size:String,disabled:Boolean,buttonText:{type:String,default:"上传文件"},buttonType:{type:String,default:"default"},tip:{type:String,default:""},append:{type:String,default:""},uploadRequest:{type:Function,default:null},multiple:{type:Boolean,default:!1},triggerForm:{type:Boolean,default:!0}},emits:["update:modelValue","change","delete","focus","blur"],setup(i,{emit:v}){const n=i,l=e.inject("govFormItem",null),s=v;S.useReset(l,n,o=>{s("update:modelValue",o)});const h=e.computed(()=>(n==null?void 0:n.size)||(l==null?void 0:l.size)),g=e.computed(()=>(n==null?void 0:n.disabled)||(l==null?void 0:l.disabled)),f=e.ref(null),B=()=>{f.value&&!g.value&&f.value.click()},u=e.computed({get:()=>n.modelValue.map(o=>{const t={...o};return t.id||(t.id=Symbol()),t.status||(t.status="success"),t.name||(t.name=""),t.type||(t.type=t.url&&t.url.match(/\.(jpeg|jpg|gif|png)$/)?"img":"file"),["img","filex"].includes(t.type)||(t.type="file"),t.progress===void 0&&(t.progress=0),!t.url&&!t.id&&(t.status="failed"),t}),set:o=>{s("change",o),s("update:modelValue",o),n.triggerForm&&(l==null||l.$emit("change"))}}),_=(o,t)=>{const a=u.value.findIndex(c=>c.id===o);if(a!==-1){const c=[...u.value];t(c[a]),s("update:modelValue",c)}},V=o=>{const t=o.target.files,a=Array.from(t).map(d=>({id:Symbol(),status:"pending",name:d.name,type:d.type.startsWith("image/")?"img":"file",progress:0,_file:d}));s("update:modelValue",[...u.value,...a]);const c=()=>{s("change",u.value),n.triggerForm&&(l==null||l.$emit("change"))};e.nextTick(()=>{a.forEach(d=>{if(n.uploadRequest){const y=d._file;n.uploadRequest(y,d.id,m=>{_(d.id,r=>{r.progress=m})}).then(({url:m,response:r})=>{_(d.id,k=>{k.status="success",k.url=m,k.response=r,c()})}).catch(m=>{_(d.id,r=>{r.status="failed",r.response=m,c()})})}})})},b=o=>{const t=u.value.filter(a=>a.id!==o);s("delete",o),s("change",t),s("update:modelValue",t),n.triggerForm&&(l==null||l.$emit(["change","delete"]))};function E(){s("focus"),n.triggerForm&&(l==null||l.$emit("focus"))}function N(){s("blur"),n.triggerForm&&(l==null||l.$emit("blur"))}return(o,t)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["gov-upload",[{"is-disabled":g.value}]]),tabindex:"0",onFocus:E,onBlur:N},[e.createElementVNode("div",$,[e.createElementVNode("label",x,[e.createVNode(C.default,{size:h.value,type:i.buttonType,disabled:g.value,onClick:B},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(i.buttonText),1)]),_:1},8,["size","type","disabled"]),e.createElementVNode("input",e.mergeProps(o.$attrs,{type:"file",multiple:i.multiple,ref_key:"fileInput",ref:f,disabled:g.value,onChange:V,class:"gov-upload__original"}),null,16,z)]),e.renderSlot(o.$slots,"append",{},()=>[i.append?(e.openBlock(),e.createElementBlock("div",q,e.toDisplayString(i.append),1)):e.createCommentVNode("",!0)])]),e.renderSlot(o.$slots,"tip",{},()=>[i.tip?(e.openBlock(),e.createElementBlock("div",T,e.toDisplayString(i.tip),1)):e.createCommentVNode("",!0)]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.value,(a,c)=>(e.openBlock(),e.createElementBlock("div",{class:"gov-upload__list",key:c},[e.createElementVNode("div",{class:e.normalizeClass(["gov-upload__item",[`is-${a.status}`]])},[e.createElementVNode("div",D,[e.createElementVNode("div",j,[a.status==="pending"?(e.openBlock(),e.createBlock(p.default,{key:0,name:"time"})):e.createCommentVNode("",!0),a.status==="success"?(e.openBlock(),e.createBlock(p.default,{key:1,name:"success"})):e.createCommentVNode("",!0),a.status==="failed"?(e.openBlock(),e.createBlock(p.default,{key:2,name:"error"})):e.createCommentVNode("",!0)]),e.createElementVNode("div",w,[e.createElementVNode("div",R,[a.type==="img"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[a.status==="success"?(e.openBlock(),e.createElementBlock("img",{key:0,src:a.url},null,8,F)):(e.openBlock(),e.createBlock(p.default,{key:1,name:"picture-outline"}))],64)):(e.openBlock(),e.createBlock(p.default,{key:1,name:"folder-opened"}))]),e.createElementVNode("div",A,e.toDisplayString(a.name),1)]),g.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:"gov-upload__delete",onClick:d=>b(a.id)},[e.createVNode(p.default,{name:"circle-close"})],8,M))]),a.status==="pending"?(e.openBlock(),e.createElementBlock("div",O,[e.createElementVNode("div",{class:"gov-upload__progress-bar",style:e.normalizeStyle({width:`${a.progress}%`})},null,4)])):e.createCommentVNode("",!0)],2)]))),128))],34))}});exports.default=P;
